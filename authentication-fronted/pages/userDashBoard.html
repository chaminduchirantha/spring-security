<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        /* Hide content until validation */
        body {
            display: none;
        }
    </style>
</head>
<body>

<h1>Welcome to User Dashboard</h1>

<script>
    const token = localStorage.getItem('token');
    const username = localStorage.getItem('username');

    if (!token || !username) {
        window.location.href = 'signIn.html';
    } else {
        $.ajax({
            method: 'GET',
            url: 'http://localhost:8080/hello/api/user-info',
            headers: {
                'Authorization': 'Bearer ' + token
            },
            success: function (response) {
                if (response.role === 'USER') {
                    $('body').show(); // allow page to show
                    console.log(" Access granted for USER:", username);
                } else {
                    alert("Access Denied: You are not a regular user.");
                    window.location.href = 'signIn.html';
                }
            },
            error: function () {
                alert("Session expired or unauthorized.");
                localStorage.clear();
                window.location.href = 'signIn.html';
            }
        });
    }
</script>

</body>
</html>
